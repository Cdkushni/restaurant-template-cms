<?php/* * Adds and sends a message to a list */require_once '../cms/icontact/config.php';require_once '../cms/icontact/util.php';/***********************************//** set your account details here **//***********************************///$accountId      = 1001413;//$clientFolderId = 9196527;//$campaignId     = 53917;//$listId         = 8485;$messageId = addMessage();if ($sendto_lacrosse) { sendMessageToList($messageId, $listId_Lacrosse); }if ($sendto_hockey) { sendMessageToList($messageId, $listId_Hockey); }function addMessage(){	global $accountId, $clientFolderId, $campaignId;	global $iNewsletter, $title;		$messageId = null;		$response = callResource("/a/{$accountId}/c/{$clientFolderId}/messages",		'POST', array(			array(				'campaignId'  => $campaignId,				'subject'     => $title,				'messageType' => 'normal',				'textBody'    => strip_tags($iNewsletter),				'htmlBody'    => $iNewsletter,			)		));		if ($response['code'] == STATUS_CODE_SUCCESS) {		//echo "<h1>Success - Add Message</h1>\n";				$messageId = $response['data']['messages'][0]['messageId'];				$warningCount = 0;		if (!empty($response['data']['warnings'])) {			$warningCount = count($response['data']['warnings']);		}				alert ("<p><b>Success!</b> Added message {$messageId}, with {$warningCount} warnings.</p>", true);				//dump($response['data']);	} else {		//echo "<h1>Error - Add Message</h1>\n";				alert ("<p><b>Error Code:</b> {$response['code']}</p>", true);				//dump($response['data']);	}		return $messageId;}function sendMessageToList($messageId, $listId){	global $accountId, $clientFolderId;		date_default_timezone_set("Canada/Eastern"); // must be in Eastern Time Zone for this to work.	$scheduledTime = date("c");		$response = callResource("/a/{$accountId}/c/{$clientFolderId}/sends",		'POST', array(			array(				'messageId'      => $messageId,				'includeListIds' => $listId,				'scheduledTime'  => $scheduledTime,			)		));		if ($response['code'] == STATUS_CODE_SUCCESS) {		//echo "<h1>Success - Send Message</h1>\n";				$sends = $response['data']['sends'];		$sent = !empty($sends);		if ($sent) {			$recipientCount = $sends[0]['recipientCount'];		}				$warningCount = 0;		if (!empty($response['data']['warnings'])) {			$warningCount = count($response['data']['warnings']);		}				if ($sent) {			alert ("<p><b>Success!</b> The message was sent to {$recipientCount} recipients, with {$warningCount} warnings.</p>", true);		} else {			alert ("<p><b>Error!</b> The message was not sent, see the {$warningCount} warnings below.</p>", false);		}				//dump($response['data']);	} else {		//echo "<h1>Error - Send Message</h1>\n";				alert ("<p><b>Error Code:</b> {$response['code']}</p>", false);				//dump($response['data']);	}}?>